<!DOCTYPE html>
<html lang="en-us">

<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
         二进制表示float-point &middot; Nevermoi 
    </title>

    <!-- CSS -->
    <link rel="stylesheet" href="/public/css/poole.css">
    <link rel="stylesheet" href="/public/css/syntax.css">
    <link rel="stylesheet" href="/public/css/lanyon.css">
    <link rel="stylesheet" href="/public/css/style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <!-- Icons -->
    <link rel="logo" sizes="144x144" href="/public/logo.png">
    <link rel="shortcut icon" href="/public/favicon.png">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


<body class="theme-base-0c sidebar-overlay">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-item">
        <p>『Never』 『Moi』</p>
    </div>

    <nav class="sidebar-nav">
        <a class="sidebar-nav-item" href="/">Home</a>
        
        
        
            
                
            
        
            
                
            
        
            
                
                    <a class="sidebar-nav-item" href="/about/">About</a>
                
            
        
            
        
            
        
        <span class="sidebar-nav-item">Currently v0.0.2</span>
    </nav>

    <div class="sidebar-item">
        <p>
            &copy; 2016. All rights reserved.
        </p>
    </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
        <div class="masthead">
            <div class="container">
                <h3 class="masthead-title">
            <a href="/" title="Home">Nevermoi</a>
            <small>Nevermoi means never ever touch me</small>
          </h3>
            </div>
        </div>

        <div class="container content">
            <div class="post">
  <h1 class="post-title">二进制表示float-point</h1>
  <span class="post-date">12 Feb 2016</span>
  <p>在讨论float-point之前，我们先看int型在计算机内部是怎么表示的：</p>

<p><code>int i = 5;</code></p>

<p>上面的statement声明了一个int型变量 i，并赋值为 5，其二进制为101。在32位计算机中，4个字节表示int变量，所以，5被以32位二进制的方式保存在了计算机里 ”00000000 00000000 00000000 00000101“，其16进制表示为 0x00000005。</p>

<p>那么当这个int型的i被转换为float型的时候，怎么表示？</p>

<p>根据 ”IEEE 754“ 国际标准，任意一个二进制浮点数V可以表示为：</p>

<p><code>V = (-1)^S x M x 2^E</code></p>

<p>S M E这三个将被存入计算机内部。 其中S是符号位，当S=0时，表示正数，S=1时，表示负数。M是有效数字，2&gt;M&gt;=1。E是指数位。</p>

<p>上面的例子中 i 的十进制是 5， 二进制为 101， 表示成IEEE 754形式为：(-1)^0 x 1.01 x 2^2。 则：S = 0, M = 1.01, E = 2。</p>

<pre><code>1. 在32位计算机中，最高位是S=0，接下来的8位为指数E=2 (0000 0010)，剩下的23位是M=1.01
2. 在64位计算机中，最高位是S=0，接下来的11位为指数E=2 (0000 0000 010)，剩下的52位是M=1.01
</code></pre>

<ol>
  <li>
    <p>S没啥好说的， 要么1，要么0.</p>
  </li>
  <li>
    <p>先说M，因为比E简单。我们知道M的值介于1和2之间，IEEE 754就觉得 M=1.xxxxx中的1也可以省略掉，于是就只保存xxxxx部分，读出来的时候再加上1。于是，在32位计算机中，M的有效位变成了24位；64位系统中变成了53位。</p>
  </li>
  <li>
    <p>说到E，在32位和64位计算机中，它的位数不同所以真实值也不同，但又因为其有正负之分，为了平均表示正负，IEEE 754 规定要减去一个中位数。8位E的情况下，E可以表示0～255，其中位数为 127；11位E的情况下，E可以表示0～2047，其中位数为1023。这个中位数就是正负的分界线。</p>
  </li>
</ol>

<p>例如：101 = (-1)^0 x 1.01 x 2^2，E=2，在保存成64位的时候会变成2+1023=1025 (1000 0000 001 );</p>

<p>接下来我解释一下为啥javascript中 <code>0.5-0.25=0.25</code> 而 <code>0.4-0.1=0.30000000000...04</code> 这样怪东西。</p>

<p>首先呢，有两个概念，一个是定点小数，一个是浮点小数。</p>

<ol>
  <li>定点小数有个问题是，一些小数不可能用二进制准确表达出来，比如说0.2。总有舍弃一些末位。在javascript中，能在console显示或者其他print出来的都是定点小数。</li>
  <li>浮点小数就相对精确一些，因为它舍弃的位更低，所以表示的范围也更大一点。</li>
</ol>

<p>一个非2的幂级数的倒数的数， 无论定点还是浮点小数，都不能在计算机中100%准确表示。</p>

<p>所以减出来就不是精确的了。</p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/02/15/understand-LCS/">
            Understand Longest Common Subsequence
            <small>15 Feb 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/02/13/http-header-note/">
            我们走一遍http中request/response header部分
            <small>13 Feb 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/01/26/principles-of-ood/">
            Principles of OOD and examples
            <small>26 Jan 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

        </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
        (function (document) {
            var toggle = document.querySelector('.sidebar-toggle');
            var sidebar = document.querySelector('#sidebar');
            var checkbox = document.querySelector('#sidebar-checkbox');
            document.addEventListener('click', function (e) {
                var target = e.target;
                if (!checkbox.checked ||
                    sidebar.contains(target) ||
                    (target === checkbox || target === toggle)) return;
                checkbox.checked = false;
            }, false);
        })(document);
    </script>
</body>

</html>
